<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>${title}</title>
<script src="${request.contextPath}/js/jsloader.js"
	type='text/javascript'></script>
<script src="${request.contextPath}/js/app/appEngine.js"
	type='text/javascript'></script>
<script src="${request.contextPath}/dwr/engine.js"
	type='text/javascript'></script>
<script src="${request.contextPath}/dwr/interface/RemoteService.js"
	type='text/javascript'></script>
</head>
<body>
	<form id="loginForm" name="loginForm" action="login.do" method="post" onsubmit="return validataLoginForm();">
			<table>
				<tr>
					<td valign="middle" align="center">
					<div class=" loginbox">
					<div class="login">
					<table border="1" class="inputbox" id="logon_table">
						<tr>
							<td height="25" align="right">用&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;户：</td>
							<td><input id="j_username" name="j_username" autocomplete="off" type="text"  class="txt" value="" /></td>
						</tr>
						<tr>
							<td height="25" align="right">口&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;令：</td>
							<td><input id="j_password" name="j_password" autocomplete="off" type="password" value="" class="txt" /></td>
						</tr>
						<tr>
							<td height="25" align="right">校&nbsp;验&nbsp;码&nbsp;：</td>
							<td>
							<input id="j_captcha" name="j_captcha" autocomplete="off" type="text" class="txt" style="width: 70px"/> 
							<span id="jcaptchaspan"><img id="jcaptchaimg" src="jcaptcha?onlynum=true" title="看不清,点击换另一张" style="cursor: pointer;" ></span>
							</td>
						</tr> 
						<tr>
							<td height="50" colspan="2" align="center" id="msg" class="error"></td>
						</tr>
						<tr>
							<td height="24" colspan="2" align="center">
								<input type="submit" class="but1" value="提交" />
								<input type="button" class="but2" value="重置" onclick="mreset()" id="resetBtn" />
							</td>
						</tr>
					</table>
					</div>
					</div>
					</td>
				</tr>
			</table>
		</form>

	<script type='text/javascript'>
		/* var ajax = new AppAjax("test.do", function(data) {
			if (data) {
				$('username').value = data.name;
				$('age').value = data.age;
				$('sex').value = data.sex;
			}
		});
		ajax.submit(); */

		var jq = jQuery.noConflict();

		jq("#jcaptchaspan").click(o_captch);
		
		

		function o_captch() {
			jq("#jcaptchaspan").empty();
			jq(
					'<img id="jcaptchaimg" src="jcaptcha?onlynum=true&radom='
							+ new Date()
							+ '" title="看不清,点击换另一张" style="cursor: pointer;" >')
					.appendTo("#jcaptchaspan");
		}
		
		function validataLoginForm(){
			   if(jq("#j_username").val() == ""){
				  jq("#msg").text("登录用户名不能为空");
				  jq("#j_username").focus();
			      return false;
			   }
			   if(jq("#j_password").val() == ""){
				  jq("#msg").text("用户口令不能为空");
				  jq("#j_password").focus();
			      return false;
			   }
			   if(jq("#j_captcha").val() == ""){
				  jq("#msg").text("校验码不能为空");
				  jq("#j_captcha").focus();
			      return false;
			   }
			   
			   var endate = new Date();
			   
			   RemoteService.forCheckUser(jq("#j_username").val(),jq("#j_password").val(),jq("#j_captcha").val(),endate,{
				   async:true,
				   callback:function(data)
				 {
					   
				   if(data.code > 0 ){
			   		    window.location.href="login.do"; 
				   }else {
					   jq("#msg").text(data.text);
					  /*  o_captch(); */
					   return false;
				   }
			   }});
			  
			}
		
		function mreset(){
			this.location = this.location;
		}
	</script>
</body>
</html>